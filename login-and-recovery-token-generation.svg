<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1557" height="901"><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1557" height="901"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="602.2417459718093" y="24.50280495" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login &amp; Recovery Token Generation</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 95.887643371 L 44.631447682160164 901.2131660609997" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 791.5724844613269 95.887643371 L 791.5724844613269 901.2131660609997" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray="12.565541,5.445067766666667"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.167601650000002 51.782594461 L 81.09529371432032 51.782594461 L 81.09529371432032 95.887643371 L 8.167601650000002 95.887643371 L 8.167601650000002 51.782594461 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="25.891297230500008" y="79.55244007099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 752.2596851820964 51.782594461 L 830.8852837405574 51.782594461 L 830.8852837405574 95.887643371 L 752.2596851820964 95.887643371 L 752.2596851820964 51.782594461 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="769.9833807625964" y="79.55244007099999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Server</text></g></g><g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="128.558049971" width="230.61986030640625" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="143.259732941" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Enter email address and password</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 149.793814261 L 109.97226088216016 149.793814261 L 109.97226088216016 171.029578551 L 47.3539815654935 171.029578551" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,171.029578551) translate(-44.631447682160164,-171.029578551)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 164.22324384266665 L 44.631447682160164 171.029578551 L 58.244117098826834 177.83591325933332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="195.53238350099997" width="721.8937250525" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="210.23406647099995" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Generate 32 byte master key (PBKDF2 (salt: keccak(email), password: keccak(password), iterations: 100000))</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 216.768147791 L 109.97226088216016 216.768147791 L 109.97226088216016 238.00391208099998 L 47.3539815654935 238.00391208099998" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,238.00391208099998) translate(-44.631447682160164,-238.00391208099998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 231.19757737266664 L 44.631447682160164 238.00391208099998 L 58.244117098826834 244.81024678933332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="262.506717031" width="412.3162714392187" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="277.208400001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Generate 32 byte authentication key (key keccak(master_key))</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 283.74248132099996 L 109.97226088216016 283.74248132099996 L 109.97226088216016 304.978245611 L 47.3539815654935 304.978245611" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,304.978245611) translate(-44.631447682160164,-304.978245611)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 298.17191090266664 L 44.631447682160164 304.978245611 L 58.244117098826834 311.7845803193333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="293.81924233943886" y="329.48105056099996" width="248.56544746460938" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="296.2695228344389" y="344.18273353099994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication key and email address</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 350.716814851 L 788.8499505779936 350.716814851" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(791.5724844613269,350.716814851) translate(-791.5724844613269,-350.716814851)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 777.9598150446602 343.91048014266664 L 791.5724844613269 350.716814851 L 777.9598150446602 357.5231495593333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="810.9024750329936" y="375.21961980099996" width="317.8353144079687" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="813.3527555279936" y="389.92130277099994" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Retrieve salt and stored authentication key hash</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 791.5724844613269 396.4553840909999 L 856.9132976613269 396.4553840909999 L 856.9132976613269 417.69114838099995 L 794.2950183446602 417.69114838099995" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(791.5724844613269,417.69114838099995) translate(-791.5724844613269,-417.69114838099995)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 805.1851538779936 410.8848136726666 L 791.5724844613269 417.69114838099995 L 805.1851538779936 424.4974830893333 Z"/></g></g><g><g><rect fill="white" stroke="none" x="810.9024750329936" y="442.19395333099993" width="741.292406693125" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="813.3527555279936" y="456.8956363009999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Generate authentication key hash (PBKDF2(salt: random_salt, password: authentication_key, iterations: 100000))</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 791.5724844613269 463.4297176209999 L 856.9132976613269 463.4297176209999 L 856.9132976613269 484.6654819109999 L 794.2950183446602 484.6654819109999" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(791.5724844613269,484.6654819109999) translate(-791.5724844613269,-484.6654819109999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 805.1851538779936 477.8591472026666 L 791.5724844613269 484.6654819109999 L 805.1851538779936 491.47181661933325 Z"/></g></g><g><g><rect fill="white" stroke="none" x="810.9024750329936" y="509.1682868609999" width="404.2275263220312" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="813.3527555279936" y="523.8699698309999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Compare generated authentication key hash with stored hash</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 791.5724844613269 530.4040511509999 L 856.9132976613269 530.4040511509999 L 856.9132976613269 551.6398154409999 L 794.2950183446602 551.6398154409999" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(791.5724844613269,551.6398154409999) translate(-791.5724844613269,-551.6398154409999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 805.1851538779936 544.8334807326665 L 791.5724844613269 551.6398154409999 L 805.1851538779936 558.4461501493332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="383.4505518487162" y="576.1426203909998" width="69.30282844605469" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="385.9008323437162" y="590.8443033609998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Logged in</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 791.5724844613269 597.3783846809998 L 47.3539815654935 597.3783846809998" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,597.3783846809998) translate(-44.631447682160164,-597.3783846809998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 590.5720499726665 L 44.631447682160164 597.3783846809998 L 58.244117098826834 604.1847193893332 Z"/></g></g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="621.8811896309998" width="205.35859932007813" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="636.5828726009997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Generate 32 byte recovery key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 643.1169539209998 L 109.97226088216016 643.1169539209998 L 109.97226088216016 664.3527182109998 L 47.3539815654935 664.3527182109998" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,664.3527182109998) translate(-44.631447682160164,-664.3527182109998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 657.5463835026665 L 44.631447682160164 664.3527182109998 L 58.244117098826834 671.1590529193331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="688.8555231609997" width="325.8738886267187" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="703.5572061309997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Encrypt master key with recovery key (AES CBC)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 710.0912874509997 L 109.97226088216016 710.0912874509997 L 109.97226088216016 731.3270517409998 L 47.3539815654935 731.3270517409998" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,731.3270517409998) translate(-44.631447682160164,-731.3270517409998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 724.5207170326664 L 44.631447682160164 731.3270517409998 L 58.244117098826834 738.1333864493331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="63.96143825382683" y="755.8298566909997" width="276.2390009314062" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="66.41171874882683" y="770.5315396609997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Store recovery key in device local storage</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 777.0656209809997 L 109.97226088216016 777.0656209809997 L 109.97226088216016 798.3013852709997 L 47.3539815654935 798.3013852709997" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(44.631447682160164,798.3013852709997) translate(-44.631447682160164,-798.3013852709997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 58.244117098826834 791.4950505626664 L 44.631447682160164 798.3013852709997 L 58.244117098826834 805.1077199793331 Z"/></g></g><g><g><rect fill="white" stroke="none" x="314.62454019100136" y="822.8041902209997" width="206.95485176148438" height="21.23576429"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="317.0748206860014" y="837.5058731909996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Encrypted recovery master key</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 44.631447682160164 844.0399545109997 L 788.8499505779936 844.0399545109997" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(791.5724844613269,844.0399545109997) translate(-791.5724844613269,-844.0399545109997)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 777.9598150446602 837.2336198026663 L 791.5724844613269 844.0399545109997 L 777.9598150446602 850.846289219333 Z"/></g></g></g><g/><g/></g></svg>